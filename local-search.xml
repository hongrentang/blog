<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>xargs命令使用</title>
    <link href="/2024/07/29/xargs%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/07/29/xargs%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="命令简介"><a href="#命令简介" class="headerlink" title="命令简介"></a>命令简介</h3><p>​xargs可以将stdin中以空格或换行符进行分隔的数据，形成以空格分隔的参数（arguments），传递给其他<a href="http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247503585&idx=1&sn=4479870e9509cfea8221b7034f2eb8ac&chksm=e918abfdde6f22eb129d650de68059e16862b98889ba63843e64f710429b56333b045687b81c&scene=21#wechat_redirect">命令</a>。因为以空格作为分隔符，所以有一些文件名或者其他意义的字符串内含有空格的时候，xargs可能会误判。简单来说，xargs的作用是给其他命令传递参数，是构建单行命令的重要组件之一。</p><p>之所以要用到xargs，是因为很多命令不支持使用管道|来传递参数，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">find /sbin -perm +700 | <span class="hljs-built_in">ls</span> -l         <span class="hljs-comment"># 这个命令是错误,因为标准输入不能作为ls的参数</span><br>find /sbin -perm +700 | xargs <span class="hljs-built_in">ls</span> -l   <span class="hljs-comment"># 这样才是正确的</span><br></code></pre></td></tr></table></figure><h3 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">xargs [OPTIONS] [COMMAND]<br></code></pre></td></tr></table></figure><h3 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">-0, --null<br>  <span class="hljs-comment">#如果输入的stdin含有特殊字符，例如反引号 `、反斜杠 \、空格等字符时，xargs将它还原成一般字符。为默认选项</span><br>-a, --arg-file=FILE<br>  <span class="hljs-comment">#从指定的文件FILE中读取输入内容而不是从标准输入</span><br>-d, --delimiter=DEL<br>  <span class="hljs-comment">#指定xargs处理输入内容时的分隔符。xargs处理输入内容默认是按空格和换行符作为分隔符，输出arguments时按空格分隔</span><br>-E EOF_STR<br>  <span class="hljs-comment">#EOF_STR是end of file string，表示输入的结束</span><br>-e, --eof[=EOF_STR]<br>  <span class="hljs-comment">#作用等同于 -E 选项，与 -E 选项不同时，该选项不符合POSIX标准且EOF_STR不是强制的。如果没有EOF_STR则表示输入没有结束符</span><br>-I REPLACE_STR<br>  <span class="hljs-comment">#将xargs输出的每一项参数单独赋值给后面的命令，参数需要用指定的替代字符串REPLACE_STR代替。REPLACE_STR可以使用&#123;&#125; $ @ 等符号，其主要作用是当xargs command后有多个参数时，调整参数位置。</span><br>  例如备份以 txt 为后缀的文件：find . -name <span class="hljs-string">&quot;*.txt&quot;</span> | xargs -I &#123;&#125;  <span class="hljs-built_in">cp</span> &#123;&#125; /tmp/&#123;&#125;.bak<br>-i, --replace[=REPLACE_STR]<br>  <span class="hljs-comment">#作用同 -I 选项，参数 REPLACE_STR 是可选的，缺省为 &#123;&#125;。建议使用 -I 选项，因为其符合 POSIX</span><br>-L MAX_LINES<br>  <span class="hljs-comment">#限定最大输入行数。隐含了 -x 选项</span><br>-l, --max-lines[=MAX_LINES]<br>  <span class="hljs-comment">#作用同 -L 选项，参数 MAX_LINES 是可选的，缺省为 1。建议使用 -L 选项，因为其符合 POSIX 标准</span><br>-n, --max-args=MAX_ARGS<br>  <span class="hljs-comment">#表示命令在执行的时候一次使用参数的最大个数</span><br>-o, --open-tty<br>  <span class="hljs-comment">#在执行命令之前，在子进程中重新打开stdin作为/dev/TTY。如果您希望xargs运行交互式应用程序，这是非常有用的</span><br>-P, --max-procs=MAX_PROCS<br>  <span class="hljs-comment">#每次运行最大进程；缺省值为 1。如果MAX_PROCS为 0，xargs将一次运行尽可能多的进程。一般和-n或-L选项一起使用</span><br>-p, --interactive<br>  <span class="hljs-comment">#当每次执行一个argument的时候询问一次用户</span><br>--process-slot-var=NAME<br>  <span class="hljs-comment">#将指定的环境变量设置为每个正在运行的子进程中的唯一值。一旦子进程退出，将重用该值。例如，这可以用于初始负荷分配方案</span><br>-r, --no-run-if-empty<br>  <span class="hljs-comment">#当 xargs 的输入为空的时候则停止xargs，不用再去执行后面的命令了。为默认选项</span><br>-s, --max-chars=MAX_CHARS<br>  <span class="hljs-comment">#命令行的最大字符数，指的是xargs后面那个命令的最大命令行字符数，包括命令、空格和换行符。每个参数单独传入xargs后面的命令</span><br>--show-limits<br>  <span class="hljs-comment">#显示操作系统对命令行长度的限制</span><br>-t， --verbose<br>  <span class="hljs-comment">#先打印命令到标准错误输出，然后再执行</span><br>-x, --<span class="hljs-built_in">exit</span><br>  <span class="hljs-comment">#配合 -s 使用，当命令行字符数大于 -s 指定的数值时，退出 xargs</span><br>--<span class="hljs-built_in">help</span><br>  <span class="hljs-comment">#显示帮助信息并退出</span><br>--version<br>  <span class="hljs-comment">#显示版本信息并退出</span><br></code></pre></td></tr></table></figure><h3 id="常用示例"><a href="#常用示例" class="headerlink" title="常用示例"></a>常用示例</h3><ol><li><p>将shell的特殊字符反引号还原为一般字符。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@VM-0-10-ubuntu:~# <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;`0123`4 56780&#x27;</span> |xargs -t <span class="hljs-built_in">echo</span><br><span class="hljs-built_in">echo</span> `0123`4 56780 <br>`0123`4 56780<br></code></pre></td></tr></table></figure></li><li><p>设置 xargs 读入参数时的结束标识，以逗号结束。这里要注意结束标志必须要是单独的字段，即以空格或者换行符分隔的字段。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@VM-0-10-ubuntu:~# <span class="hljs-built_in">echo</span> 01234 , 56789 | xargs -E <span class="hljs-string">&quot;,&quot;</span><br>01234<br></code></pre></td></tr></table></figure></li><li><p>使用 rm、mv 等命令同时操作多个文件时，有时会报 “argument list too long” 参数列表过长的错误，此时可以使用 xargs 来解决。xargs 将标准输入的字符串分隔后，作为参数传递给后面的命令。例如，给当前目录的所有文件添加后缀名。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> | xargs -t -i <span class="hljs-built_in">mv</span> &#123;&#125; &#123;&#125;.bak<br><br><span class="hljs-comment"># 选择符合条件的文件</span><br><span class="hljs-built_in">ls</span> | grep -E <span class="hljs-string">&quot;201701|201702|201703&quot;</span> | xargs -I &#123;&#125; <span class="hljs-built_in">mv</span> &#123;&#125; &#123;&#125;.bak<br></code></pre></td></tr></table></figure></li><li><p>设置命令行的最大字符数。参数默认一个一个单独传入命令中执行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;01234 56789&quot;</span> | xargs -t -s 11<br><span class="hljs-built_in">echo</span> 01234 <br>01234<br><span class="hljs-built_in">echo</span> 56789 <br>56789<br></code></pre></td></tr></table></figure></li><li><p>设置标准输入中每次多少行作为命令的参数，默认是将标准输入中所有行的归并到一行一次性传给命令执行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;01234\n56789\n01234&quot;</span> | xargs -t -L 2 <span class="hljs-built_in">echo</span><br><span class="hljs-built_in">echo</span> 01234 56789 <br>01234 56789<br><span class="hljs-built_in">echo</span> 01234 <br>01234<br></code></pre></td></tr></table></figure></li><li><p>将文件内容以空格分隔合并为一行输出。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 列出文件内容</span><br><span class="hljs-built_in">cat</span> test.txt<br>a b c d e<br>f g h i j <br>k l m n o<br><br><span class="hljs-comment"># 多行输入合并为一行输出</span><br><span class="hljs-built_in">cat</span> test.txt | xargs<br>a b c d e f g h i j k l m n o<br></code></pre></td></tr></table></figure></li><li><p>与ps、grep、awk和kill结合，强制终止指定进程。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -ef | grep spp | awk <span class="hljs-string">&#x27;&#123;printf &quot;%s &quot;,$2&#125;&#x27;</span> | xargs <span class="hljs-built_in">kill</span> -9<br>1<br></code></pre></td></tr></table></figure><p>ps -ef|grep spp用于查找包含 spp 的进程，awk ‘{printf “%s “,$2,FNR}将目标进程 ID 打印输出，xargs kill -9则将目标进程 ID 作为参数传递给kill -9用于杀死进程。</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>常用的正则表达式</title>
    <link href="/2024/07/29/%E5%B8%B8%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <url>/2024/07/29/%E5%B8%B8%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>1.匹配中文字符的正则表达式：<code>[\u4e00-\u9fa5]</code></p><p>评注：匹配中文还真是个头疼的事，有了这个表达式就好办了</p><p>2.匹配双字节字符(包括汉字在内)：<code>[^\x00-\xff]</code></p><p>评注：可以用来计算字符串的长度（一个双字节字符长度计2，ASCII字符计1）</p><p>3.匹配空白行的正则表达式：<code>\n\s*\r</code></p><p>评注：可以用来删除空白行</p><p>4.匹配 HTML 标记的正则表达式：<code>&lt;(\S*?)[^&gt;]*&gt;.*?&lt;/\1&gt;|&lt;.*? /&gt;</code></p><p>评注：网上流传的版本太糟糕，上面这个也仅仅能匹配部分，对于复杂的嵌套标记依旧无能为力</p><p>5.匹配首尾空白字符的正则表达式：<code>^\s*|\s*$</code></p><p>评注：可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式</p><p>6.匹配Email地址的正则表达式：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">\w+<span class="hljs-comment">([-+.]\w+)</span>*@\w+<span class="hljs-comment">([-.]\w+)</span>*\.\w+<span class="hljs-comment">([-.]\w+)</span>*<br></code></pre></td></tr></table></figure><p>评注：表单验证时很实用</p><p>7.匹配网址URL的正则表达式：<code>[a-zA-z]+://[^\s]*</code></p><p>评注：网上流传的版本功能很有限，上面这个基本可以满足需求</p><p>8.匹配帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：<code>^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$</code></p><p>评注：表单验证时很实用</p><p>9.匹配国内电话号码：<code>\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;</code></p><p>评注：匹配形式如 0511-4405222 或 021-87888822</p><p>10.匹配腾讯QQ号：<code>[1-9][0-9]&#123;4,&#125;</code></p><p>评注：腾讯QQ号从10000开始</p><p>11.匹配中国邮政编码：<code>[1-9]\d&#123;5&#125;(?!\d)</code></p><p>评注：中国邮政编码为6位数字</p><p>12.匹配×××：<code>\d&#123;15&#125;|\d&#123;18&#125;</code></p><p>评注：中国的×××为15位或18位</p><p>13.匹配ip地址：<code>\d+\.\d+\.\d+\.\d+</code></p><p>评注：提取 IP 地址时有用</p><p>14.匹配特定数字：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gams">^[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*<span class="hljs-symbol">$</span>   <span class="hljs-comment">//匹配正整数</span><br>^-[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*<span class="hljs-symbol">$</span>  <span class="hljs-comment">//匹配负整数</span><br>^-?[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*<span class="hljs-symbol">$</span>  <span class="hljs-comment">//匹配整数</span><br>^[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*|<span class="hljs-number">0</span><span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配非负整数（正整数 + 0）</span><br>^-[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*|<span class="hljs-number">0</span><span class="hljs-symbol">$</span>  <span class="hljs-comment">//匹配非正整数（负整数 + 0）</span><br>^[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*\.\d*|<span class="hljs-number">0</span>\.\d*[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*<span class="hljs-symbol">$</span>  <span class="hljs-comment">//匹配正浮点数</span><br>^-([<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*\.\d*|<span class="hljs-number">0</span>\.\d*[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*)<span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配负浮点数</span><br>^-?([<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*\.\d*|<span class="hljs-number">0</span>\.\d*[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*|<span class="hljs-number">0</span>?\<span class="hljs-number">.0</span>+|<span class="hljs-number">0</span>)<span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配浮点数</span><br>^[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*\.\d*|<span class="hljs-number">0</span>\.\d*[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*|<span class="hljs-number">0</span>?\<span class="hljs-number">.0</span>+|<span class="hljs-number">0</span><span class="hljs-symbol">$</span>  <span class="hljs-comment">//匹配非负浮点数（正浮点数 + 0）</span><br>^(-([<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*\.\d*|<span class="hljs-number">0</span>\.\d*[<span class="hljs-number">1</span><span class="hljs-number">-9</span>]\d*))|<span class="hljs-number">0</span>?\<span class="hljs-number">.0</span>+|<span class="hljs-number">0</span><span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配非正浮点数（负浮点数 + 0）</span><br></code></pre></td></tr></table></figure><p>评注：处理大量数据时有用，具体应用时注意修正</p><p>15.匹配特定字符串：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gams">^[A-Za-z]+<span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配由26个英文字母组成的字符串</span><br>^[A-Z]+<span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配由26个英文字母的大写组成的字符串</span><br>^[a-z]+<span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配由26个英文字母的小写组成的字符串</span><br>^[A-Za-z0<span class="hljs-number">-9</span>]+<span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配由数字和26个英文字母组成的字符串</span><br>^\w+<span class="hljs-symbol">$</span> <span class="hljs-comment">//匹配由数字、26个英文字母或者下划线组成的字符串</span><br></code></pre></td></tr></table></figure><p>评注：最基本也是最常用的一些表达式</p>]]></content>
    
    
    
    <tags>
      
      <tag>正则</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux运维必备的40个命令总结</title>
    <link href="/2024/07/29/linux%E8%BF%90%E7%BB%B4%E5%BF%85%E5%A4%87%E7%9A%8440%E4%B8%AA%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
    <url>/2024/07/29/linux%E8%BF%90%E7%BB%B4%E5%BF%85%E5%A4%87%E7%9A%8440%E4%B8%AA%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<ol><li><p>删除0字节文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find -<span class="hljs-built_in">type</span> f -size 0 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rf &#123;&#125; \;<br></code></pre></td></tr></table></figure></li><li><p>查看进程按内存从大到小排列</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS -e -o <span class="hljs-string">&quot;%C : %p : %z : %a&quot;</span>|<span class="hljs-built_in">sort</span> -k5 -nr<br></code></pre></td></tr></table></figure></li><li><p>按 CPU 利用率从大到小排列</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -e -o <span class="hljs-string">&quot;%C : %p : %z : %a&quot;</span>|<span class="hljs-built_in">sort</span> -nr<br></code></pre></td></tr></table></figure></li><li><p>打印 cache 里的URL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -r -a jpg /data/cache/* | strings | grep <span class="hljs-string">&quot;http:&quot;</span> | awk -F<span class="hljs-string">&#x27;http:&#x27;</span> <span class="hljs-string">&#x27;&#123;print &quot;http:&quot;$2;&#125;&#x27;</span><br><br><br></code></pre></td></tr></table></figure></li><li><p>查看 http 的并发请求数及其 TCP 连接状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -n | awk <span class="hljs-string">&#x27;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>sed 在这个文里 Root 的一行，匹配 Root 一行，将 no 替换成 yes</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sed -i <span class="hljs-string">&#x27;/Root/s/no/yes/&#x27;</span> /etc/ssh/sshd_config <br></code></pre></td></tr></table></figure></li><li><p>如何杀掉 MySQL 进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps aux |grep mysql |grep -v grep  |awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> |xargs <span class="hljs-built_in">kill</span> -9 <br>(从中了解到awk的用途)<br><br>killall -TERM mysqld<br><br><span class="hljs-built_in">kill</span> -9 `<span class="hljs-built_in">cat</span> /usr/local/apache2/logs/httpd.pid`   <span class="hljs-comment">#试试查杀进程PID</span><br></code></pre></td></tr></table></figure></li><li><p>显示运行 3 级别开启的服务:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> /etc/rc3.d/S* |<span class="hljs-built_in">cut</span> -c 15-   (从中了解到<span class="hljs-built_in">cut</span>的用途，截取数据)<br></code></pre></td></tr></table></figure></li><li><p>如何在编写 SHELL 显示多个信息，用 EOF</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">+--------------------------------------------------------------+</span><br><span class="hljs-string">|       === Welcome to Tunoff services ===                  |</span><br><span class="hljs-string">+--------------------------------------------------------------+</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure></li><li><p>for 的巧用（如给 MySQL 建软链接）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/local/mysql/bin<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> *<br><span class="hljs-keyword">do</span> <span class="hljs-built_in">ln</span> /usr/local/mysql/bin/<span class="hljs-variable">$i</span> /usr/bin/<span class="hljs-variable">$i</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li><li><p>取 IP 地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ifconfig eth0 |grep <span class="hljs-string">&quot;inet addr:&quot;</span> |awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>| <span class="hljs-built_in">cut</span> -c 6-  <br>或者：<br>ifconfig | grep <span class="hljs-string">&#x27;inet addr:&#x27;</span>| grep -v <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> | <span class="hljs-built_in">cut</span> -d: -f2 | awk <span class="hljs-string">&#x27;&#123; print $1&#125;&#x27;</span><br><br></code></pre></td></tr></table></figure></li><li><p>内存的大小：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">free -m |grep <span class="hljs-string">&quot;Mem&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>查看ESTABLISHED 的链接数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -an -t | grep <span class="hljs-string">&quot;:80&quot;</span> | grep ESTABLISHED | awk <span class="hljs-string">&#x27;&#123;printf &quot;%s %s\n&quot;,$5,$6&#125;&#x27;</span> | <span class="hljs-built_in">sort</span><br><br></code></pre></td></tr></table></figure></li><li><p>查看 Apache 的并发请求数及其 TCP 连接状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -n | awk <span class="hljs-string">&#x27;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>因为同事要统计一下服务器下面所有的 jpg 的文件的大小，写了个 SHELL 给他来统计。原来用 xargs 实现，但他一次处理一部分。搞的有多个总和……，下面的命令就能解决。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -name *.jpg -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">wc</span> -c &#123;&#125; \;|awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>|awk <span class="hljs-string">&#x27;&#123;a+=$1&#125;END&#123;print a&#125;&#x27;</span><br><br></code></pre></td></tr></table></figure></li></ol><p>CPU 的数量（多核算多个CPU，cat &#x2F;proc&#x2F;cpuinfo |grep -c processor）越多，系统负载越低，每秒能处理的请求数也越多。</p><ol start="16"><li><p>CPU负载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/loadavg<br>检查前三个输出值是否超过了系统逻辑 CPU 的4倍。<br></code></pre></td></tr></table></figure></li><li><p>CPU负载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">mpstat 1 1<br>检查 %idle 是否过低（比如小于5%）<br></code></pre></td></tr></table></figure></li><li><p>内存空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">free<br>检查 free 值是否过低，也可以用 <span class="hljs-comment"># cat /proc/meminfo</span><br></code></pre></td></tr></table></figure></li><li><p>SWAP空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">free<br>检查 swap used 值是否过高，如果 swap used 值过高，进一步检查 swap 动作是否频繁：<br>vmstat 1 5<br>观察 si 和 so 值是否较大<br></code></pre></td></tr></table></figure></li><li><p>磁盘空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">df</span> -h<br>检查是否有分区使用率（Use%）过高（比如超过90%）如发现某个分区空间接近用尽，可以进入该分区的挂载点，用以下命令找出占用空间最多的文件或目录：<br><span class="hljs-built_in">du</span> -cks * | <span class="hljs-built_in">sort</span> -rn | <span class="hljs-built_in">head</span> -n 10<br></code></pre></td></tr></table></figure></li><li><p>磁盘 I&#x2F;O 负载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">iostat -x 1 2<br>检查I/O使用率（%util）是否超过 100%<br></code></pre></td></tr></table></figure></li><li><p>网络负载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sar -n DEV<br>检查网络流量（rxbyt/s, txbyt/s）是否过高<br></code></pre></td></tr></table></figure></li><li><p>网络错误</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -i<br>检查是否有网络错误（drop fifo colls carrier），也可以用命令：# <span class="hljs-built_in">cat</span> /proc/net/dev<br></code></pre></td></tr></table></figure></li><li><p>网络连接数目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -an | grep -E <span class="hljs-string">&quot;^(tcp)&quot;</span> | <span class="hljs-built_in">cut</span> -c 68- | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -n<br></code></pre></td></tr></table></figure></li><li><p>进程总数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps aux | <span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure></li><li><p>可运行进程数目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vmstat 1 5<br>列给出的是可运行进程的数目，检查其是否超过系统逻辑 CPU 的 4 倍<br></code></pre></td></tr></table></figure></li><li><p>进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">top -<span class="hljs-built_in">id</span> 1<br>观察是否有异常进程出现<br></code></pre></td></tr></table></figure></li><li><p>网络状态，检查DNS，网关等是否可以正常连通</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ping <br>traceroute<br>nslookup<br>dig <br></code></pre></td></tr></table></figure></li><li><p>用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">who</span> | <span class="hljs-built_in">wc</span> -l<br>检查登录用户是否过多 (比如超过50个)   也可以用命令：# <span class="hljs-built_in">uptime</span>。<br></code></pre></td></tr></table></figure></li><li><p>系统日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat /var/log/rflogview/*errors</span><br>检查是否有异常错误记录   也可以搜寻一些异常关键字，例如：<br><br>grep -i error /var/log/messages<br>grep -i fail /var/log/messages<br></code></pre></td></tr></table></figure></li><li><p>核心日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">dmesg<br>检查是否有异常错误记录。<br></code></pre></td></tr></table></figure></li><li><p>系统时间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">date</span><br>检查系统时间是否正确。<br></code></pre></td></tr></table></figure></li><li><p>打开文件数目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof -w | <span class="hljs-built_in">wc</span> -l<br>检查打开文件总数是否过多。<br></code></pre></td></tr></table></figure></li><li><p>日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># logwatch –print</span><br>配置 /etc/log.d/logwatch.conf，将 Mailto 设置为自己的 email 地址，启动 mail 服务(sendmail或者postfix)，这样就可以每天收到日志报告了。<br>缺省 logwatch 只报告昨天的日志，可以用 <span class="hljs-comment"># logwatch –print –range all 获得所有的日志分析结果。</span><br>可以用 <span class="hljs-comment"># logwatch –print –detail high 获得更具体的日志分析结果(而不仅仅是出错日志)。</span><br></code></pre></td></tr></table></figure></li><li><p>杀掉80端口相关的进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof -i :80|grep -v “ID”|awk ‘&#123;<span class="hljs-built_in">print</span> “<span class="hljs-built_in">kill</span> -9”,<span class="hljs-variable">$2</span>&#125;’|sh<br></code></pre></td></tr></table></figure></li><li><p>清除僵死进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -eal | awk <span class="hljs-string">&#x27;&#123; if ($2 == &quot;Z&quot;) &#123;print $4&#125;&#125;&#x27;</span> | <span class="hljs-built_in">kill</span> -9<br></code></pre></td></tr></table></figure></li><li><p>tcpdump 抓包，用来防止80端口被人攻击时可以分析数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tcpdump -c 10000 -i eth0 -n dst port 80 &gt; /root/pkts<br></code></pre></td></tr></table></figure></li></ol><p>38、然后检查IP的重复数并从小到大排序 注意 “-t\ +0”  中间是两个空格</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq"># less pkts | <span class="hljs-type">awk</span> &#123;&#x27;printf $<span class="hljs-number">3</span><span class="hljs-string">&quot;\n&quot;</span>&#x27;&#125; | <span class="hljs-type">cut</span> -d. -f <span class="hljs-number">1</span><span class="hljs-number">-4</span> | <span class="hljs-type">sort</span> | <span class="hljs-type">uniq</span> -c | <span class="hljs-type">awk</span> &#123;&#x27;printf $<span class="hljs-number">1</span><span class="hljs-string">&quot; &quot;</span>$<span class="hljs-number">2</span><span class="hljs-string">&quot;\n&quot;</span>&#x27;&#125; | <span class="hljs-type">sort</span> -n -t\ +<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>39、查看有多少个活动的 php-cgi 进程</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">netstat -anp | <span class="hljs-type">grep</span> php-cgi | <span class="hljs-type">grep</span> ^tcp | <span class="hljs-type">wc</span> -l<br></code></pre></td></tr></table></figure><p>40、查看系统自启动的服务</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">chkconfig</span> --list | awk <span class="hljs-string">&#x27;&#123;if (<span class="hljs-variable">$5</span>==&quot;3:on&quot;) print <span class="hljs-variable">$1</span>&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>41、kudzu 查看网卡型号</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">kudzu --probe --<span class="hljs-keyword">class</span>=<span class="hljs-symbol">network</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
